<div class="p-4 sm:p-8 space-y-12 animate-fade-in text-slate-800 dark:text-slate-100">

    <!-- Premium Header Section -->
    <div class="relative group">
        <div
            class="absolute -inset-1 bg-gradient-to-r from-sea via-tangerine to-blush rounded-[3rem] blur opacity-10 group-hover:opacity-25 transition duration-1000">
        </div>
        <div
            class="relative flex flex-col lg:flex-row items-center justify-between gap-8 p-10 glass dark:bg-slate-800/40 rounded-[3rem] overflow-hidden">
            <div class="flex items-center gap-8 relative z-10">
                <div
                    class="w-20 h-20 bg-gradient-to-br from-sea to-blue-600 rounded-[1.8rem] flex items-center justify-center shadow-2xl shadow-sea/30 text-3xl font-black text-white transform group-hover:scale-110 transition-transform">
                    üìö
                </div>
                <div>
                    <h2 class="text-3xl sm:text-4xl font-black tracking-tight mb-2">Mati√®res par Niveau</h2>
                    <p class="text-lg text-slate-500 dark:text-slate-400 font-medium">G√©rez le programme √©ducatif pour
                        chaque niveau.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column: Selection & List -->
        <div class="lg:col-span-2 space-y-8">

            <!-- Filter Section -->
            <div class="glass dark:bg-slate-800/40 p-8 rounded-[2.5rem] border-white/60">
                <label class="block text-xs font-black uppercase tracking-widest text-slate-400 mb-3">S√©lectionner un
                    niveau</label>
                <div class="relative">
                    <select [(ngModel)]="selectedNiveau" (ngModelChange)="onNiveauChange()"
                        class="w-full px-6 py-4 bg-white/40 dark:bg-slate-700/40 border-2 border-white/60 focus:border-sea/50 rounded-2xl text-sm font-black text-slate-700 dark:text-white outline-none transition-all cursor-pointer appearance-none">
                        <option *ngFor="let n of niveaux" [value]="n.id">{{ n.label }}</option>
                    </select>
                    <div class="absolute right-6 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </div>
            </div>

            <!-- List Section -->
            <div class="space-y-4">
                <div class="flex items-center justify-between px-4">
                    <h3 class="text-lg font-black text-slate-700 dark:text-slate-200">Mati√®res d√©finies ({{
                        matieres().length }})</h3>
                </div>

                <div *ngIf="loading()" class="p-12 text-center text-slate-400 animate-pulse">
                    Chargement des mati√®res...
                </div>

                <div *ngIf="!loading() && matieres().length === 0"
                    class="glass dark:bg-slate-800/40 p-12 rounded-[2.5rem] text-center opacity-50">
                    <p class="text-lg font-bold">Aucune mati√®re pour ce niveau.</p>
                </div>

                <div *ngFor="let m of matieres()"
                    class="glass bg-white/40 dark:bg-slate-800/20 p-6 rounded-[2rem] border border-white/60 hover:bg-white dark:hover:bg-slate-700/50 transition-all group">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold shadow-lg"
                                [style.background-color]="m.couleur || '#3b82f6'">
                                {{ m.code }}
                            </div>
                            <div>
                                <h4 class="text-lg font-black text-slate-800 dark:text-white">{{ m.nom }}</h4>
                                <p class="text-sm text-slate-500 font-medium line-clamp-1">{{ m.description || 'Aucune
                                    description' }}</p>
                            </div>
                        </div>
                        <div
                            class="px-3 py-1 rounded-full text-[10px] uppercase font-black tracking-widest bg-slate-100 text-slate-500">
                            H√©rit√© par les classes
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Add Form -->
        <div class="lg:col-span-1">
            <div class="sticky top-8">
                <div class="glass dark:bg-slate-800/40 p-8 rounded-[2.5rem] border-white/60 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-sea/10 rounded-full blur-3xl -mr-16 -mt-16"></div>

                    <h3 class="text-xl font-black text-slate-800 dark:text-white mb-6 relative z-10">Ajouter une mati√®re
                    </h3>

                    <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-6 relative z-10">
                        <div>
                            <label class="block text-xs font-black uppercase tracking-widest text-slate-400 mb-2">Nom de
                                la mati√®re</label>
                            <input type="text" formControlName="nom" placeholder="Ex: Math√©matiques"
                                class="w-full px-5 py-4 bg-white/50 dark:bg-slate-700/50 border-2 border-transparent focus:border-sea/50 rounded-2xl text-sm font-bold outline-none transition-all placeholder-slate-400">
                        </div>

                        <div>
                            <label
                                class="block text-xs font-black uppercase tracking-widest text-slate-400 mb-2">Description
                                (Optionnelle)</label>
                            <textarea formControlName="description" rows="3" placeholder="Courte description..."
                                class="w-full px-5 py-4 bg-white/50 dark:bg-slate-700/50 border-2 border-transparent focus:border-sea/50 rounded-2xl text-sm font-medium outline-none transition-all placeholder-slate-400 resize-none"></textarea>
                        </div>

                        <div class="pt-4">
                            <button type="submit" [disabled]="form.invalid || submitting()"
                                class="w-full py-4 bg-sea hover:bg-sea/90 text-white rounded-2xl font-black uppercase tracking-widest shadow-lg shadow-sea/30 transition-all hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center gap-2">
                                <span *ngIf="!submitting()">Confirmer l'ajout</span>
                                <span *ngIf="submitting()" class="animate-pulse">Enregistrement...</span>
                            </button>
                            <p class="text-center text-[10px] text-slate-400 mt-4 font-medium">
                                Cette mati√®re sera automatiquement ajout√©e aux programmes des classes de {{
                                selectedNiveau() }}.
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>